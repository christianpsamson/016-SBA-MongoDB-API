//////////////////////////////////////////////////////////////////////////////////////////////////
// import the dependencies
//////////////////////////////////////////////////////////////////////////////////////////////////
import express from "express";
import connectDb from "../db/conn.mjs";
import Shipwrecks from "../schemas/shipwreckSchema.mjs";

const readRouter = express.Router();

//////////////////////////////////////////////////////////////////////////////////////////////////
// retrieve documents: this function will be evoked in startServer()
//////////////////////////////////////////////////////////////////////////////////////////////////

let oneDoc;

const retrieveDoc = async () => {
  try {
    oneDoc = await Shipwrecks.findOne({ feature_type: "Wrecks - Visible" });
    console.log(oneDoc);
  } catch (error) {
    console.log("Error in READ process", error);
  }
};

//////////////////////////////////////////////////////////////////////////////////////////////////
// establish the connection to mongodb
//////////////////////////////////////////////////////////////////////////////////////////////////

const startServer = async () => {
  await connectDb();
  await retrieveDoc();

  readRouter.get("/", async (req, res) => {
    try {
      res.send(oneDoc);
    } catch (error) {
      console.error("error in handling the route", error);
    }
  });
};

startServer();

//////////////////////////////////////////////////////////////////////////////////////////////////
// export module
//////////////////////////////////////////////////////////////////////////////////////////////////

export default readRouter;
